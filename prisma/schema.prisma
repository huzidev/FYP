generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

//////////////////// USERS ////////////////////

model Admin {
  id        Int       @id @default(autoincrement())
  fullName  String
  email     String    @unique
  password  String
  role      AdminRole
  isActive  Boolean   @default(true)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@map("admins")
}

model Staff {
  id        Int       @id @default(autoincrement())
  fullName  String
  email     String    @unique
  password  String
  role      StaffRole
  isActive  Boolean   @default(true)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@map("staff")
}

model Student {
  id           Int          @id @default(autoincrement())
  fullName     String
  email        String       @unique
  password     String
  studentId    String       @unique
  level        StudentLevel
  departmentId Int
  isActive     Boolean      @default(true)
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt

  department  Department   @relation(fields: [departmentId], references: [id])
  enrollments Enrollment[]
  vouchers    FeeVoucher[]

  @@map("students")
}

//////////////////// ACADEMICS ////////////////////

model Department {
  id       Int          @id @default(autoincrement())
  name     String       @unique
  code     String       @unique
  level    StudentLevel
  isActive Boolean      @default(true)

  students       Student[]
  subjects       Subject[]
  departmentFees DepartmentFee[]

  @@map("departments")
}

model Subject {
  id           Int    @id @default(autoincrement())
  name         String
  code         String @unique
  creditHours  Int    @default(3)
  departmentId Int

  department  Department   @relation(fields: [departmentId], references: [id])
  enrollments Enrollment[]
  subjectFee  SubjectFee?

  @@map("subjects")
}

model Enrollment {
  id        Int    @id @default(autoincrement())
  studentId Int
  subjectId Int
  semester  String
  year      String

  student Student @relation(fields: [studentId], references: [id])
  subject Subject @relation(fields: [subjectId], references: [id])

  @@unique([studentId, subjectId, semester, year])
  @@map("enrollments")
}

//////////////////// FEES CORE ////////////////////

model FeeVoucher {
  id           Int      @id @default(autoincrement())
  challanNo    String   @unique
  billId       String   @unique
  semester     String
  academicYear String
  validTill    DateTime

  totalAmount Float
  status      FeeStatus @default(PENDING)

  studentId Int
  student   Student @relation(fields: [studentId], references: [id])

  items    FeeVoucherItem[]
  payments Payment[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("fee_vouchers")
}

model FeeVoucherItem {
  id           Int   @id @default(autoincrement())
  voucherId    Int
  particularId Int
  amount       Float

  voucher    FeeVoucher    @relation(fields: [voucherId], references: [id])
  particular FeeParticular @relation(fields: [particularId], references: [id])

  @@map("fee_voucher_items")
}

model Payment {
  id        Int      @id @default(autoincrement())
  voucherId Int
  amount    Float
  method    String
  paidAt    DateTime @default(now())

  voucher FeeVoucher @relation(fields: [voucherId], references: [id])

  @@map("payments")
}

//////////////////// FEE CONFIG ////////////////////

model FeeParticular {
  id       Int     @id @default(autoincrement())
  name     String  @unique
  isActive Boolean @default(true)

  voucherItems   FeeVoucherItem[]
  departmentFees DepartmentFee[]

  @@map("fee_particulars")
}

model DepartmentFee {
  departmentId Int
  particularId Int
  amount       Float

  department Department    @relation(fields: [departmentId], references: [id])
  particular FeeParticular @relation(fields: [particularId], references: [id])

  @@id([departmentId, particularId])
  @@map("department_fees")
}

model SubjectFee {
  id          Int   @id @default(autoincrement())
  subjectId   Int   @unique
  ratePerCrHr Float

  subject Subject @relation(fields: [subjectId], references: [id])

  @@map("subject_fees")
}

//////////////////// ENUMS ////////////////////

enum AdminRole {
  ADMIN
  SUPER_ADMIN
}

enum StaffRole {
  ADMISSION
  TEACHER
}

enum StudentLevel {
  BACHELOR
  MASTER
}

enum FeeStatus {
  PENDING
  PAID
  PARTIAL
  OVERDUE
}
